Drupal.behaviors.textarea=function(context){$('textarea.resizable:not(.textarea-processed)',context).each(function(){if($(this).is('textarea.teaser:not(.teaser-processed)'))return false;var textarea=$(this).addClass('textarea-processed'),staticOffset=null;$(this).wrap('<div class="resizable-textarea"><span></span></div>').parent().append($('<div class="grippie"></div>').mousedown(startDrag));var grippie=$('div.grippie',$(this).parent())[0];grippie.style.marginRight=(grippie.offsetWidth-$(this)[0].offsetWidth)+'px'
function startDrag(e){staticOffset=textarea.height()-e.pageY;textarea.css('opacity',0.25);$(document).mousemove(performDrag).mouseup(endDrag);return false}
function performDrag(e){textarea.height(Math.max(32,staticOffset+e.pageY)+'px');return false}
function endDrag(e){$(document).unbind("mousemove",performDrag).unbind("mouseup",endDrag);textarea.css('opacity',1)}})};
Drupal.behaviors.tableDrag=function(context){for(var base in Drupal.settings.tableDrag)if(!$('#'+base+'.tabledrag-processed',context).size()){var tableSettings=Drupal.settings.tableDrag[base];$('#'+base).filter(':not(.tabledrag-processed)').each(function(){Drupal.tableDrag[base]=new Drupal.tableDrag(this,tableSettings)});$('#'+base).addClass('tabledrag-processed')}};Drupal.tableDrag=function(table,tableSettings){var self=this;this.table=table;this.tableSettings=tableSettings;this.dragObject=null;this.rowObject=null;this.oldRowElement=null;this.oldY=0;this.changed=false;this.maxDepth=0;this.rtl=$(this.table).css('direction')=='rtl'?-1:1;this.scrollSettings={amount:4,interval:50,trigger:70};this.scrollInterval=null;this.scrollY=0;this.windowHeight=0;this.indentEnabled=false;for(group in tableSettings)for(n in tableSettings[group]){if(tableSettings[group][n]['relationship']=='parent')this.indentEnabled=true;if(tableSettings[group][n]['limit']>0)this.maxDepth=tableSettings[group][n]['limit']};if(this.indentEnabled){this.indentCount=1;var indent=Drupal.theme('tableDragIndentation'),testCell=$('> tbody > tr.draggable:first td:first, > tr.draggable:first td:first',table).prepend(indent).prepend(indent);this.indentAmount=$('.indentation',testCell).get(1).offsetLeft-$('.indentation',testCell).get(0).offsetLeft;$('.indentation',testCell).slice(0,2).remove()};$('> tr.draggable, > tbody > tr.draggable',table).each(function(){self.makeDraggable(this)});this.hideColumns();$(document).bind('mousemove',function(event){return self.dragRow(event,self)});$(document).bind('mouseup',function(event){return self.dropRow(event,self)})};Drupal.tableDrag.prototype.hideColumns=function(){for(var group in this.tableSettings){for(var d in this.tableSettings[group]){var field=$('.'+this.tableSettings[group][d]['target']+':first',this.table);if(field.size()&&this.tableSettings[group][d]['hidden']){var hidden=this.tableSettings[group][d]['hidden'],cell=field.parents('td:first');break}};if(hidden&&cell[0]&&cell.css('display')!='none'){var columnIndex=$('> td',cell.parent()).index(cell.get(0))+1,headerIndex=$('> td:not(:hidden)',cell.parent()).index(cell.get(0))+1;$('> thead > tr, > tbody > tr, > tr',this.table).each(function(){var row=$(this),parentTag=row.parent().get(0).tagName.toLowerCase(),index=(parentTag=='thead')?headerIndex:columnIndex;row.children().each(function(n){if(n<index)index-=(this.colSpan&&this.colSpan>1)?this.colSpan-1:0});if(index>0){cell=row.children(':nth-child('+index+')');if(cell[0].colSpan>1){cell[0].colSpan=cell[0].colSpan-1}else parentTag=='thead'?cell.remove():cell.css('display','none')}})}}};Drupal.tableDrag.prototype.rowSettings=function(group,row){var field=$('.'+group,row);for(delta in this.tableSettings[group]){var targetClass=this.tableSettings[group][delta]['target'];if(field.is('.'+targetClass)){var rowSettings=new Object();for(var n in this.tableSettings[group][delta])rowSettings[n]=this.tableSettings[group][delta][n];return rowSettings}}};Drupal.tableDrag.prototype.makeDraggable=function(item){var self=this,handle=$('<a href="#" class="tabledrag-handle"><div class="handle">&nbsp;</div></a>').attr('title',Drupal.t('Drag to re-order'));if($('td:first .indentation:last',item).after(handle).size()){self.indentCount=Math.max($('.indentation',item).size(),self.indentCount)}else $('td:first',item).prepend(handle);handle.hover(function(){self.dragObject==null?$(this).addClass('tabledrag-handle-hover'):null},function(){self.dragObject==null?$(this).removeClass('tabledrag-handle-hover'):null});handle.mousedown(function(event){self.dragObject=new Object();self.dragObject.initMouseOffset=self.getMouseOffset(item,event);self.dragObject.initMouseCoords=self.mouseCoords(event);if(self.indentEnabled)self.dragObject.indentMousePos=self.dragObject.initMouseCoords;if(self.rowObject)$('a.tabledrag-handle',self.rowObject.element).blur();self.rowObject=new self.row(item,'mouse',self.indentEnabled,self.maxDepth,true);self.table.topY=self.getPosition(self.table).y;self.table.bottomY=self.table.topY+self.table.offsetHeight;$(this).addClass('tabledrag-handle-hover');$(item).addClass('drag');$('body').addClass('drag');if(self.oldRowElement)$(self.oldRowElement).removeClass('drag-previous');if(navigator.userAgent.indexOf('MSIE 6.')!=-1)$('select',this.table).css('display','none');self.safeBlur=false;self.onDrag();return false});handle.click(function(){return false});handle.focus(function(){$(this).addClass('tabledrag-handle-hover');self.safeBlur=true});handle.blur(function(event){$(this).removeClass('tabledrag-handle-hover');if(self.rowObject&&self.safeBlur)self.dropRow(event,self)});handle.keydown(function(event){if(event.keyCode!=9&&!self.rowObject)self.rowObject=new self.row(item,'keyboard',self.indentEnabled,self.maxDepth,true);var keyChange=false;switch(event.keyCode){case 37:case 63234:keyChange=true;self.rowObject.indent(-1*self.rtl);break;case 38:case 63232:var previousRow=$(self.rowObject.element).prev('tr').get(0);while(previousRow&&$(previousRow).is(':hidden'))previousRow=$(previousRow).prev('tr').get(0);if(previousRow){self.safeBlur=false;self.rowObject.direction='up';keyChange=true;if($(item).is('.tabledrag-root')){var groupHeight=0;while(previousRow&&$('.indentation',previousRow).size()){previousRow=$(previousRow).prev('tr').get(0);groupHeight+=$(previousRow).is(':hidden')?0:previousRow.offsetHeight};if(previousRow){self.rowObject.swap('before',previousRow);window.scrollBy(0,-groupHeight)}}else if(self.table.tBodies[0].rows[0]!=previousRow||$(previousRow).is('.draggable')){self.rowObject.swap('before',previousRow);self.rowObject.interval=null;self.rowObject.indent(0);window.scrollBy(0,-parseInt(item.offsetHeight))};handle.get(0).focus()};break;case 39:case 63235:keyChange=true;self.rowObject.indent(1*self.rtl);break;case 40:case 63233:var nextRow=$(self.rowObject.group).filter(':last').next('tr').get(0);while(nextRow&&$(nextRow).is(':hidden'))nextRow=$(nextRow).next('tr').get(0);if(nextRow){self.safeBlur=false;self.rowObject.direction='down';keyChange=true;if($(item).is('.tabledrag-root')){var groupHeight=0;nextGroup=new self.row(nextRow,'keyboard',self.indentEnabled,self.maxDepth,false);if(nextGroup){$(nextGroup.group).each(function(){groupHeight+=$(this).is(':hidden')?0:this.offsetHeight});nextGroupRow=$(nextGroup.group).filter(':last').get(0);self.rowObject.swap('after',nextGroupRow);window.scrollBy(0,parseInt(groupHeight))}}else{self.rowObject.swap('after',nextRow);self.rowObject.interval=null;self.rowObject.indent(0);window.scrollBy(0,parseInt(item.offsetHeight))};handle.get(0).focus()};break};if(self.rowObject&&self.rowObject.changed==true){$(item).addClass('drag');if(self.oldRowElement)$(self.oldRowElement).removeClass('drag-previous');self.oldRowElement=item;self.restripeTable();self.onDrag()};if(keyChange)return false});handle.keypress(function(event){switch(event.keyCode){case 37:case 38:case 39:case 40:return false}})};Drupal.tableDrag.prototype.dragRow=function(event,self){if(self.dragObject){self.currentMouseCoords=self.mouseCoords(event);var y=self.currentMouseCoords.y-self.dragObject.initMouseOffset.y,x=self.currentMouseCoords.x-self.dragObject.initMouseOffset.x;if(y!=self.oldY){self.rowObject.direction=y>self.oldY?'down':'up';self.oldY=y;var scrollAmount=self.checkScroll(self.currentMouseCoords.y);clearInterval(self.scrollInterval);if(scrollAmount>0&&self.rowObject.direction=='down'||scrollAmount<0&&self.rowObject.direction=='up')self.setScroll(scrollAmount);var currentRow=self.findDropTargetRow(x,y);if(currentRow){if(self.rowObject.direction=='down'){self.rowObject.swap('after',currentRow,self)}else self.rowObject.swap('before',currentRow,self);self.restripeTable()}};if(self.indentEnabled){var xDiff=self.currentMouseCoords.x-self.dragObject.indentMousePos.x,indentDiff=Math.round(xDiff/self.indentAmount*self.rtl),indentChange=self.rowObject.indent(indentDiff);self.dragObject.indentMousePos.x+=self.indentAmount*indentChange*self.rtl;self.indentCount=Math.max(self.indentCount,self.rowObject.indents)};return false}};Drupal.tableDrag.prototype.dropRow=function(event,self){if(self.rowObject!=null){var droppedRow=self.rowObject.element;if(self.rowObject.changed==true){self.updateFields(droppedRow);for(var group in self.tableSettings){var rowSettings=self.rowSettings(group,droppedRow);if(rowSettings.relationship=='group')for(n in self.rowObject.children)self.updateField(self.rowObject.children[n],group)};self.rowObject.markChanged();if(self.changed==false){$(Drupal.theme('tableDragChangedWarning')).insertAfter(self.table).hide().fadeIn('slow');self.changed=true}};if(self.indentEnabled)self.rowObject.removeIndentClasses();if(self.oldRowElement)$(self.oldRowElement).removeClass('drag-previous');$(droppedRow).removeClass('drag').addClass('drag-previous');self.oldRowElement=droppedRow;self.onDrop();self.rowObject=null};if(self.dragObject!=null){$('.tabledrag-handle',droppedRow).removeClass('tabledrag-handle-hover');self.dragObject=null;$('body').removeClass('drag');clearInterval(self.scrollInterval);if(navigator.userAgent.indexOf('MSIE 6.')!=-1)$('select',this.table).css('display','block')}};Drupal.tableDrag.prototype.getPosition=function(element){var left=0,top=0;if(element.offsetHeight==0)element=element.firstChild;while(element.offsetParent){left+=element.offsetLeft;top+=element.offsetTop;element=element.offsetParent};left+=element.offsetLeft;top+=element.offsetTop;return{x:left,y:top}};Drupal.tableDrag.prototype.mouseCoords=function(event){if(event.pageX||event.pageY)return{x:event.pageX,y:event.pageY};return{x:event.clientX+document.body.scrollLeft-document.body.clientLeft,y:event.clientY+document.body.scrollTop-document.body.clientTop}};Drupal.tableDrag.prototype.getMouseOffset=function(target,event){var docPos=this.getPosition(target),mousePos=this.mouseCoords(event);return{x:mousePos.x-docPos.x,y:mousePos.y-docPos.y}};Drupal.tableDrag.prototype.findDropTargetRow=function(x,y){var rows=this.table.tBodies[0].rows;for(var n=0;n<rows.length;n++){var row=rows[n],indentDiff=0;if(row.offsetHeight==0){var rowY=this.getPosition(row.firstChild).y,rowHeight=parseInt(row.firstChild.offsetHeight)/2}else{var rowY=this.getPosition(row).y,rowHeight=parseInt(row.offsetHeight)/2};if((y>(rowY-rowHeight))&&(y<(rowY+rowHeight))){if(this.indentEnabled)for(n in this.rowObject.group)if(this.rowObject.group[n]==row)return null;if(!this.rowObject.isValidSwap(row))return null;while($(row).is(':hidden')&&$(row).prev('tr').is(':hidden'))row=$(row).prev('tr').get(0);return row}};return null};Drupal.tableDrag.prototype.updateFields=function(changedRow){for(var group in this.tableSettings)this.updateField(changedRow,group)};Drupal.tableDrag.prototype.updateField=function(changedRow,group){var rowSettings=this.rowSettings(group,changedRow);if(rowSettings.relationship=='self'||rowSettings.relationship=='group'){var sourceRow=changedRow}else if(rowSettings.relationship=='sibling'){var previousRow=$(changedRow).prev('tr').get(0),nextRow=$(changedRow).next('tr').get(0),sourceRow=changedRow;if($(previousRow).is('.draggable')&&$('.'+group,previousRow).length){if(this.indentEnabled){if($('.indentations',previousRow).size()==$('.indentations',changedRow))sourceRow=previousRow}else sourceRow=previousRow}else if($(nextRow).is('.draggable')&&$('.'+group,nextRow).length)if(this.indentEnabled){if($('.indentations',nextRow).size()==$('.indentations',changedRow))sourceRow=nextRow}else sourceRow=nextRow}else if(rowSettings.relationship=='parent'){var previousRow=$(changedRow).prev('tr');while(previousRow.length&&$('.indentation',previousRow).length>=this.rowObject.indents)previousRow=previousRow.prev('tr');if(previousRow.length){sourceRow=previousRow[0]}else{sourceRow=$('tr.draggable:first').get(0);if(sourceRow==this.rowObject.element)sourceRow=$(this.rowObject.group[this.rowObject.group.length-1]).next('tr.draggable').get(0);var useSibling=true}};this.copyDragClasses(sourceRow,changedRow,group);rowSettings=this.rowSettings(group,changedRow);if(useSibling){rowSettings.relationship='sibling';rowSettings.source=rowSettings.target};var targetClass='.'+rowSettings.target,targetElement=$(targetClass,changedRow).get(0);if(targetElement){var sourceClass='.'+rowSettings.source,sourceElement=$(sourceClass,sourceRow).get(0);switch(rowSettings.action){case'depth':targetElement.value=$('.indentation',$(sourceElement).parents('tr:first')).size();break;case'match':targetElement.value=sourceElement.value;break;case'order':var siblings=this.rowObject.findSiblings(rowSettings);if($(targetElement).is('select')){var values=new Array();$('option',targetElement).each(function(){values.push(this.value)});var maxVal=values[values.length-1];$(targetClass,siblings).each(function(){if(values.length>0){this.value=values.shift()}else this.value=maxVal})}else{var weight=parseInt($(targetClass,siblings[0]).val())||0;$(targetClass,siblings).each(function(){this.value=weight;weight++})};break}}};Drupal.tableDrag.prototype.copyDragClasses=function(sourceRow,targetRow,group){var sourceElement=$('.'+group,sourceRow),targetElement=$('.'+group,targetRow);if(sourceElement.length&&targetElement.length)targetElement[0].className=sourceElement[0].className};Drupal.tableDrag.prototype.checkScroll=function(cursorY){var de=document.documentElement,b=document.body,windowHeight=this.windowHeight=window.innerHeight||(de.clientHeight&&de.clientWidth!=0?de.clientHeight:b.offsetHeight),scrollY=this.scrollY=(document.all?(!de.scrollTop?b.scrollTop:de.scrollTop):(window.pageYOffset?window.pageYOffset:window.scrollY)),trigger=this.scrollSettings.trigger,delta=0;if(cursorY-scrollY>windowHeight-trigger){delta=trigger/(windowHeight+scrollY-cursorY);delta=(delta>0&&delta<trigger)?delta:trigger;return delta*this.scrollSettings.amount}else if(cursorY-scrollY<trigger){delta=trigger/(cursorY-scrollY);delta=(delta>0&&delta<trigger)?delta:trigger;return-delta*this.scrollSettings.amount}};Drupal.tableDrag.prototype.setScroll=function(scrollAmount){var self=this;this.scrollInterval=setInterval(function(){self.checkScroll(self.currentMouseCoords.y);var aboveTable=self.scrollY>self.table.topY,belowTable=self.scrollY+self.windowHeight<self.table.bottomY;if(scrollAmount>0&&belowTable||scrollAmount<0&&aboveTable)window.scrollBy(0,scrollAmount)},this.scrollSettings.interval)};Drupal.tableDrag.prototype.restripeTable=function(){$('> tbody > tr.draggable, > tr.draggable',this.table).filter(':odd').filter('.odd').removeClass('odd').addClass('even').end().end().filter(':even').filter('.even').removeClass('even').addClass('odd')};Drupal.tableDrag.prototype.onDrag=function(){return null};Drupal.tableDrag.prototype.onDrop=function(){return null};Drupal.tableDrag.prototype.row=function(tableRow,method,indentEnabled,maxDepth,addClasses){this.element=tableRow;this.method=method;this.group=new Array(tableRow);this.groupDepth=$('.indentation',tableRow).size();this.changed=false;this.table=$(tableRow).parents('table:first').get(0);this.indentEnabled=indentEnabled;this.maxDepth=maxDepth;this.direction='';if(this.indentEnabled){this.indents=$('.indentation',tableRow).size();this.children=this.findChildren(addClasses);this.group=$.merge(this.group,this.children);for(var n=0;n<this.group.length;n++)this.groupDepth=Math.max($('.indentation',this.group[n]).size(),this.groupDepth)}};Drupal.tableDrag.prototype.row.prototype.findChildren=function(addClasses){var parentIndentation=this.indents,currentRow=$(this.element,this.table).next('tr.draggable'),rows=new Array(),child=0;while(currentRow.length){var rowIndentation=$('.indentation',currentRow).length;if(rowIndentation>parentIndentation){child++;rows.push(currentRow[0]);if(addClasses)$('.indentation',currentRow).each(function(indentNum){if(child==1&&(indentNum==parentIndentation))$(this).addClass('tree-child-first');if(indentNum==parentIndentation){$(this).addClass('tree-child')}else if(indentNum>parentIndentation)$(this).addClass('tree-child-horizontal')})}else break;currentRow=currentRow.next('tr.draggable')};if(addClasses&&rows.length)$('.indentation:nth-child('+(parentIndentation+1)+')',rows[rows.length-1]).addClass('tree-child-last');return rows};Drupal.tableDrag.prototype.row.prototype.isValidSwap=function(row){if(this.indentEnabled){var prevRow,nextRow;if(this.direction=='down'){prevRow=row;nextRow=$(row).next('tr').get(0)}else{prevRow=$(row).prev('tr').get(0);nextRow=row};this.interval=this.validIndentInterval(prevRow,nextRow);if(this.interval.min>this.interval.max)return false};if(this.table.tBodies[0].rows[0]==row&&$(row).is(':not(.draggable)'))return false;return true};Drupal.tableDrag.prototype.row.prototype.swap=function(position,row){$(row)[position](this.group);this.changed=true;this.onSwap(row)};Drupal.tableDrag.prototype.row.prototype.validIndentInterval=function(prevRow,nextRow){var minIndent,maxIndent;minIndent=nextRow?$('.indentation',nextRow).size():0;if(!prevRow||$(this.element).is('.tabledrag-root')){maxIndent=0}else{maxIndent=$('.indentation',prevRow).size()+($(prevRow).is('.tabledrag-leaf')?0:1);if(this.maxDepth)maxIndent=Math.min(maxIndent,this.maxDepth-(this.groupDepth-this.indents))};return{min:minIndent,max:maxIndent}};Drupal.tableDrag.prototype.row.prototype.indent=function(indentDiff){if(!this.interval){prevRow=$(this.element).prev('tr').get(0);nextRow=$(this.group).filter(':last').next('tr').get(0);this.interval=this.validIndentInterval(prevRow,nextRow)};var indent=this.indents+indentDiff;indent=Math.max(indent,this.interval.min);indent=Math.min(indent,this.interval.max);indentDiff=indent-this.indents;for(var n=1;n<=Math.abs(indentDiff);n++)if(indentDiff<0){$('.indentation:first',this.group).remove();this.indents--}else{$('td:first',this.group).prepend(Drupal.theme('tableDragIndentation'));this.indents++};if(indentDiff){this.changed=true;this.groupDepth+=indentDiff;this.onIndent()};return indentDiff};Drupal.tableDrag.prototype.row.prototype.findSiblings=function(rowSettings){var siblings=new Array(),directions=new Array('prev','next'),rowIndentation=this.indents;for(var d=0;d<directions.length;d++){var checkRow=$(this.element)[directions[d]]();while(checkRow.length){if($('.'+rowSettings.target,checkRow)){if(this.indentEnabled)var checkRowIndentation=$('.indentation',checkRow).length;if(!(this.indentEnabled)||(checkRowIndentation==rowIndentation)){siblings.push(checkRow[0])}else if(checkRowIndentation<rowIndentation)break}else break;checkRow=$(checkRow)[directions[d]]()};if(directions[d]=='prev'){siblings.reverse();siblings.push(this.element)}};return siblings};Drupal.tableDrag.prototype.row.prototype.removeIndentClasses=function(){for(n in this.children)$('.indentation',this.children[n]).removeClass('tree-child').removeClass('tree-child-first').removeClass('tree-child-last').removeClass('tree-child-horizontal')};Drupal.tableDrag.prototype.row.prototype.markChanged=function(){var marker=Drupal.theme('tableDragChangedMarker'),cell=$('td:first',this.element);if($('span.tabledrag-changed',cell).length==0)cell.append(marker)};Drupal.tableDrag.prototype.row.prototype.onIndent=function(){return null};Drupal.tableDrag.prototype.row.prototype.onSwap=function(swappedRow){return null};Drupal.theme.prototype.tableDragChangedMarker=function(){return'<span class="warning tabledrag-changed">*</span>'};Drupal.theme.prototype.tableDragIndentation=function(){return'<div class="indentation">&nbsp;</div>'};Drupal.theme.prototype.tableDragChangedWarning=function(){return'<div class="warning">'+Drupal.theme('tableDragChangedMarker')+' '+Drupal.t("Changes made in this table will not be saved until the form is submitted.")+'</div>'};
Drupal.behaviors.autocomplete=function(context){var acdb=[];$('input.autocomplete:not(.autocomplete-processed)',context).each(function(){var uri=this.value;if(!acdb[uri])acdb[uri]=new Drupal.ACDB(uri);var input=$('#'+this.id.substr(0,this.id.length-13)).attr('autocomplete','OFF')[0];$(input.form).submit(Drupal.autocompleteSubmit);new Drupal.jsAC(input,acdb[uri]);$(this).addClass('autocomplete-processed')})};Drupal.autocompleteSubmit=function(){return $('#autocomplete').each(function(){this.owner.hidePopup()}).size()==0};Drupal.jsAC=function(input,db){var ac=this;this.input=input;this.db=db;$(this.input).keydown(function(event){return ac.onkeydown(this,event)}).keyup(function(event){ac.onkeyup(this,event)}).blur(function(){ac.hidePopup();ac.db.cancel()})};Drupal.jsAC.prototype.onkeydown=function(input,e){if(!e)e=window.event;switch(e.keyCode){case 40:this.selectDown();return false;case 38:this.selectUp();return false;default:return true}};Drupal.jsAC.prototype.onkeyup=function(input,e){if(!e)e=window.event;switch(e.keyCode){case 16:case 17:case 18:case 20:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:return true;case 9:case 13:case 27:this.hidePopup(e.keyCode);return true;default:if(input.value.length>0){this.populatePopup()}else this.hidePopup(e.keyCode);return true}};Drupal.jsAC.prototype.select=function(node){this.input.value=node.autocompleteValue};Drupal.jsAC.prototype.selectDown=function(){if(this.selected&&this.selected.nextSibling){this.highlight(this.selected.nextSibling)}else{var lis=$('li',this.popup);if(lis.size()>0)this.highlight(lis.get(0))}};Drupal.jsAC.prototype.selectUp=function(){if(this.selected&&this.selected.previousSibling)this.highlight(this.selected.previousSibling)};Drupal.jsAC.prototype.highlight=function(node){if(this.selected)$(this.selected).removeClass('selected');$(node).addClass('selected');this.selected=node};Drupal.jsAC.prototype.unhighlight=function(node){$(node).removeClass('selected');this.selected=false};Drupal.jsAC.prototype.hidePopup=function(keycode){if(this.selected&&((keycode&&keycode!=46&&keycode!=8&&keycode!=27)||!keycode))this.input.value=this.selected.autocompleteValue;var popup=this.popup;if(popup){this.popup=null;$(popup).fadeOut('fast',function(){$(popup).remove()})};this.selected=false};Drupal.jsAC.prototype.populatePopup=function(){if(this.popup)$(this.popup).remove();this.selected=false;this.popup=document.createElement('div');this.popup.id='autocomplete';this.popup.owner=this;$(this.popup).css({marginTop:this.input.offsetHeight+'px',width:(this.input.offsetWidth-4)+'px',display:'none'});$(this.input).before(this.popup);this.db.owner=this;this.db.search(this.input.value)};Drupal.jsAC.prototype.found=function(matches){if(!this.input.value.length)return false;var ul=document.createElement('ul'),ac=this;for(key in matches){var li=document.createElement('li');$(li).html('<div>'+matches[key]+'</div>').mousedown(function(){ac.select(this)}).mouseover(function(){ac.highlight(this)}).mouseout(function(){ac.unhighlight(this)});li.autocompleteValue=key;$(ul).append(li)};if(this.popup)if(ul.childNodes.length>0){$(this.popup).empty().append(ul).show()}else{$(this.popup).css({visibility:'hidden'});this.hidePopup()}};Drupal.jsAC.prototype.setStatus=function(status){switch(status){case'begin':$(this.input).addClass('throbbing');break;case'cancel':case'error':case'found':$(this.input).removeClass('throbbing');break}};Drupal.ACDB=function(uri){this.uri=uri;this.delay=300;this.cache={}};Drupal.ACDB.prototype.search=function(searchString){var db=this;this.searchString=searchString;if(this.cache[searchString])return this.owner.found(this.cache[searchString]);if(this.timer)clearTimeout(this.timer);this.timer=setTimeout(function(){db.owner.setStatus('begin');$.ajax({type:"GET",url:db.uri+'/'+Drupal.encodeURIComponent(searchString),dataType:'json',success:function(matches){if(typeof matches.status=='undefined'||matches.status!=0){db.cache[searchString]=matches;if(db.searchString==searchString)db.owner.found(matches);db.owner.setStatus('found')}},error:function(xmlhttp){alert(Drupal.ahahError(xmlhttp,db.uri))}})},this.delay)};Drupal.ACDB.prototype.cancel=function(){if(this.owner)this.owner.setStatus('cancel');if(this.timer)clearTimeout(this.timer);this.searchString=''};
Drupal.Views=Drupal.Views||{};Drupal.Views.dependent={bindings:{},activeBindings:{},activeTriggers:[]};Drupal.Views.dependent.inArray=function(array,search_term){var i=array.length;if(i>0)do{if(array[i]==search_term)return true}while(i--);return false};Drupal.Views.dependent.autoAttach=function(){for(i in Drupal.Views.dependent.activeTriggers)jQuery(Drupal.Views.dependent.activeTriggers[i]).unbind('change');Drupal.Views.dependent.activeTriggers=[];Drupal.Views.dependent.activeBindings={};Drupal.Views.dependent.bindings={};if(!Drupal.settings.viewsAjax)return;for(id in Drupal.settings.viewsAjax.formRelationships){Drupal.Views.dependent.activeBindings[id]=0;for(bind_id in Drupal.settings.viewsAjax.formRelationships[id].values){if(!Drupal.Views.dependent.bindings[bind_id])Drupal.Views.dependent.bindings[bind_id]=[];Drupal.Views.dependent.bindings[bind_id].push(id);if(bind_id.substring(0,6)=='radio:'){var trigger_id="input[name='"+bind_id.substring(6)+"']"}else var trigger_id='#'+bind_id;Drupal.Views.dependent.activeTriggers.push(trigger_id);if(jQuery(trigger_id).attr('type')=='checkbox')$(trigger_id).parent().addClass('hidden-options');var getValue=function(item,trigger){if(item.substring(0,6)=='radio:'){var val=jQuery(trigger+':checked').val()}else switch(jQuery(trigger).attr('type')){case'checkbox':var val=jQuery(trigger).attr('checked')||0;if(val){$(trigger).parent().removeClass('hidden-options').addClass('expanded-options')}else $(trigger).parent().removeClass('expanded-options').addClass('hidden-options');break;default:var val=jQuery(trigger).val()};return val},setChangeTrigger=function(trigger_id,bind_id){var changeTrigger=function(){var val=getValue(bind_id,trigger_id);for(i in Drupal.Views.dependent.bindings[bind_id]){var id=Drupal.Views.dependent.bindings[bind_id][i];if(typeof id!='string')continue;if(!Drupal.Views.dependent.activeBindings[id])Drupal.Views.dependent.activeBindings[id]={};if(Drupal.Views.dependent.inArray(Drupal.settings.viewsAjax.formRelationships[id].values[bind_id],val)){Drupal.Views.dependent.activeBindings[id][bind_id]='bind'}else delete Drupal.Views.dependent.activeBindings[id][bind_id];var len=0;for(i in Drupal.Views.dependent.activeBindings[id])len++;var object=jQuery('#'+id+'-wrapper');if(!object.size())object=jQuery('#'+id).parent();var rel_num=Drupal.settings.viewsAjax.formRelationships[id].num;if(typeof rel_num==='object')rel_num=Drupal.settings.viewsAjax.formRelationships[id].num[0];if(rel_num<=len){object.show(0);object.addClass('dependent-options')}else object.hide(0)}};jQuery(trigger_id).change(function(){changeTrigger(trigger_id,bind_id)});changeTrigger(trigger_id,bind_id)};setChangeTrigger(trigger_id,bind_id)}}};Drupal.behaviors.viewsDependent=function(context){Drupal.Views.dependent.autoAttach();$("select.views-master-dependent:not(.views-processed)").addClass('views-processed').change(function(){var val=$(this).val();if(val=='all'){$('.views-dependent-all').show(0)}else{$('.views-dependent-all').hide(0);$('.views-dependent-'+val).show(0)}}).trigger('change')};
(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this};if(typeof options=='function')options={success:options};var url=$.trim(this.attr('action'));if(url)url=(url.match(/^([^#]+)/)||[])[1];url=url||window.location.href||'';options=$.extend({url:url,type:this.attr('method')||'GET',iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options||{});var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this};if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this};var a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;for(var n in options.data)if(options.data[n]instanceof Array){for(var k in options.data[n])a.push({name:n,value:options.data[n][k]})}else a.push({name:n,value:options.data[n]})};if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this};this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this};var q=$.param(a);if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null}else options.data=q;var $form=this,callbacks=[];if(options.resetForm)callbacks.push(function(){$form.resetForm()});if(options.clearForm)callbacks.push(function(){$form.clearForm()});if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){$(options.target).html(data).each(oldSuccess,arguments)})}else if(options.success)callbacks.push(options.success);options.success=function(data,status){for(var i=0,max=callbacks.length;i<max;i++)callbacks[i].apply(options,[data,status,$form])};var files=$('input:file',this).fieldValue(),found=false;for(var j=0;j<files.length;j++)if(files[j])found=true;var multipart=false;if((files.length&&options.iframe!==false)||options.iframe||found||multipart){if(options.closeKeepAlive){$.get(options.closeKeepAlive,fileUpload)}else fileUpload()}else $.ajax(options);this.trigger('form-submit-notify',[this,options]);return this
function fileUpload(){var form=$form[0];if($(':input[name=submit]',form).length){alert(Drupal.t('Error: Form elements must not be named "submit".'));return};var opts=$.extend({},$.ajaxSettings,options),s=$.extend(true,{},$.extend(true,{},$.ajaxSettings),opts),id='jqFormIO'+(new Date().getTime()),$io=$('<iframe id="'+id+'" name="'+id+'" src="'+opts.iframeSrc+'" />'),io=$io[0];$io.css({position:'absolute',top:'-1000px',left:'-1000px'});var xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;$io.attr('src',opts.iframeSrc)}},g=opts.global;if(g&&!$.active++)$.event.trigger("ajaxStart");if(g)$.event.trigger("ajaxSend",[xhr,opts]);if(s.beforeSend&&s.beforeSend(xhr,s)===false){s.global&&$.active--;return};if(xhr.aborted)return;var cbInvoked=0,timedOut=0,sub=form.clk;if(sub){var n=sub.name;if(n&&!sub.disabled){options.extraData=options.extraData||{};options.extraData[n]=sub.value;if(sub.type=="image"){options.extraData[name+'.x']=form.clk_x;options.extraData[name+'.y']=form.clk_y}}};setTimeout(function(){var t=$form.attr('target'),a=$form.attr('action');form.setAttribute('target',id);if(form.getAttribute('method')!='POST')form.setAttribute('method','POST');if(form.getAttribute('action')!=opts.url)form.setAttribute('action',opts.url);if(!options.skipEncodingOverride)$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});if(opts.timeout)setTimeout(function(){timedOut=true;cb()},opts.timeout);var extraInputs=[];try{if(options.extraData)for(var n in options.extraData)extraInputs.push($('<input type="hidden" name="'+n+'" value="'+options.extraData[n]+'" />').appendTo(form)[0]);$io.appendTo('body');io.attachEvent?io.attachEvent('onload',cb):io.addEventListener('load',cb,false);form.submit()}finally{form.setAttribute('action',a);t?form.setAttribute('target',t):$form.removeAttr('target');$(extraInputs).remove()}},10);var domCheckCount=50
function cb(){if(cbInvoked++)return;io.detachEvent?io.detachEvent('onload',cb):io.removeEventListener('load',cb,false);var ok=true;try{if(timedOut)throw'timeout';var data,doc;doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;var isXml=opts.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&(doc.body==null||doc.body.innerHTML=='')){if(--domCheckCount){cbInvoked=0;setTimeout(cb,100);return};log('Could not access iframe DOM after 50 tries.');return};xhr.responseText=doc.body?doc.body.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;xhr.getResponseHeader=function(header){var headers={'content-type':opts.dataType};return headers[header]};if(opts.dataType=='json'||opts.dataType=='script'){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value}else{var pre=doc.getElementsByTagName('pre')[0];if(pre)xhr.responseText=pre.innerHTML}}else if(opts.dataType=='xml'&&!xhr.responseXML&&xhr.responseText!=null)xhr.responseXML=toXml(xhr.responseText);data=$.httpData(xhr,opts.dataType)}catch(e){ok=false;$.handleError(opts,xhr,'error',e)};if(ok){opts.success(data,'success');if(g)$.event.trigger("ajaxSuccess",[xhr,opts])};if(g)$.event.trigger("ajaxComplete",[xhr,opts]);if(g&&!--$.active)$.event.trigger("ajaxStop");if(opts.complete)opts.complete(xhr,ok?'success':'error');setTimeout(function(){$io.remove();xhr.responseXML=null},100)}
function toXml(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s)}else doc=(new DOMParser()).parseFromString(s,'text/xml');return(doc&&doc.documentElement&&doc.documentElement.tagName!='parsererror')?doc:null}}};$.fn.ajaxForm=function(options){return this.ajaxFormUnbind().bind('submit.form-plugin',function(){$(this).ajaxSubmit(options);return false}).bind('click.form-plugin',function(e){var target=e.target,$el=$(target);if(!($el.is(":submit,input:image"))){var t=$el.closest(':submit');if(t.length==0)return;target=t[0]};var form=this;form.clk=target;if(target.type=='image')if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop};setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)})};$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin')};$.fn.formToArray=function(semantic){var a=[];if(this.length==0)return a;var form=this[0],els=semantic?form.getElementsByTagName('*'):form.elements;if(!els)return a;for(var i=0,max=els.length;i<max;i++){var el=els[i],n=el.name;if(!n)continue;if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y})};continue};var v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(var j=0,jmax=v.length;j<jmax;j++)a.push({name:n,value:v[j]})}else if(v!==null&&typeof v!='undefined')a.push({name:n,value:v})};if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0],n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y})}};return a};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n)return;var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++)a.push({name:n,value:v[i]})}else if(v!==null&&typeof v!='undefined')a.push({name:this.name,value:v})});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i],v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length))continue;v.constructor==Array?$.merge(val,v):val.push(v)};return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(typeof successful=='undefined')successful=true;if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1))return null;if(tag=='select'){var index=el.selectedIndex;if(index<0)return null;var a=[],ops=el.options,one=(t=='select-one'),max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v)v=(op.attributes&&op.attributes['value']&&!(op.attributes['value'].specified))?op.text:op.value;if(one)return v;a.push(v)}};return a};return el.value};$.fn.clearForm=function(){return this.each(function(){$('input,select,textarea',this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(t=='text'||t=='password'||tag=='textarea'){this.value=''}else if(t=='checkbox'||t=='radio'){this.checked=false}else if(tag=='select')this.selectedIndex=-1})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType))this.reset()})};$.fn.enable=function(b){if(b==undefined)b=true;return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(select==undefined)select=true;return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select}else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one')$sel.find('option').selected(false);this.selected=select}})}
function log(){if($.fn.ajaxSubmit.debug&&window.console&&window.console.log)window.console.log('[jquery.form] '+Array.prototype.join.call(arguments,''))}})(jQuery);
Drupal.behaviors.tao=function(context){$('fieldset.collapsible:not(.tao-processed) > legend > .fieldset-title').each(function(){var fieldset=$(this).parents('fieldset').eq(0);fieldset.addClass('tao-processed');if($('input.error, textarea.error, select.error',fieldset).size()>0)$(fieldset).removeClass('collapsed');$(this).click(function(){if(fieldset.is('.collapsed')){$(fieldset).removeClass('collapsed').children('.fieldset-content').show()}else $(fieldset).addClass('collapsed').children('.fieldset-content').hide();return false})})};
Drupal.behaviors.rubik=function(context){$('div.form:has(div.column-main div.buttons):not(.rubik-processed)').each(function(){var form=$(this),offset=$('div.column-side div.buttons',form).height()+$('div.column-side div.buttons',form).offset().top;$(window).scroll(function(){if($(this).scrollTop()>offset){$('div.column-main div.buttons',form).show()}else $('div.column-main div.buttons',form).hide()});form.addClass('rubik-processed')});$('a.toggler:not(.rubik-processed)',context).each(function(){var id=$(this).attr('href').split('#')[1];if($('#'+id).size()>0){$(this).click(function(){toggleable=$('#'+id);toggleable.toggle();$(this).toggleClass('toggler-active');return false})}else{$(this).addClass('toggler-disabled');$(this).click(function(){return false})};$(this).addClass('rubik-processed')})};
